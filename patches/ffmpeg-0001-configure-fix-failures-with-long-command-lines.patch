From 974f3a25674e771776ada5ac8c4cd1b87e9dbb18 Mon Sep 17 00:00:00 2001
From: Ricardo Constantino <wiiaboo@gmail.com>
Date: Sun, 4 Jun 2017 00:39:10 +0100
Subject: [PATCH] configure: fix failures with long command lines

---
 configure | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/configure b/configure
index 03dc5ab1ca..8b1e7fb65c 100755
--- a/configure
+++ b/configure
@@ -6692,6 +6692,19 @@ enabled stripping || strip="echo skipping strip"
 
 config_files="$TMPH ffbuild/config.mak doc/config.texi"
 
+if test "${#extralibs}" -gt 3000; then
+    extralib_dirs=""
+    for extralib_dir in $(printf '%s\n' $LDFLAGS $extralibs | grep '^-L' | tac | awk '!x[$0]++' | tac | tr '\n' ' '); do
+        test -d "${extralib_dir#-L}" && extralib_dirs+=" $extralib_dir"
+    done
+    extralibs_tmp="$(printf '%s\n' $extralibs | grep -v '^-L' | tr '\n' ' ')"
+    if test "${#extralibs_tmp}" -gt 2500; then
+        extralibs="$(printf '%s\n' $extralib_dirs $extralibs_tmp | tac | awk '!x[$0]++' | tac | tr '\n' ' ')"
+    else
+        extralibs="$extralib_dirs $extralibs_tmp"
+    fi
+fi
+
 cat > ffbuild/config.mak <<EOF
 # Automatically generated by configure - do not modify!
 ifndef FFMPEG_CONFIG_MAK
-- 
2.13.0

