From 54158ca0ec33d6c1411bf996e74cd39c0c8ff56c Mon Sep 17 00:00:00 2001
From: Ricardo Constantino <wiiaboo@gmail.com>
Date: Thu, 1 Jun 2017 16:06:29 +0100
Subject: [PATCH] configure: fix failures with long command lines

---
 configure | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/configure b/configure
index 40eb2bbeb0..0ff7aaf3aa 100755
--- a/configure
+++ b/configure
@@ -6688,6 +6688,19 @@ enabled stripping || strip="echo skipping strip"
 
 config_files="$TMPH ffbuild/config.mak doc/config.texi"
 
+if test "${#extralibs}" -gt 3000; then
+    extralib_dirs=""
+    for extralib_dir in $(printf '%s\n' $LDFLAGS $extralibs | grep '^-L' | tac | awk '!x[$0]++' | tac | tr '\n' ' '); do
+        test -d "${extralib_dir#-L}" && extralib_dirs+=" $extralib_dir"
+    done
+    extralibs_tmp="$(printf '%s\n' $extralibs | grep -v '^-L')"
+    if test "${#extralibs_tmp}" -gt 2500; then
+        extralibs="$(printf '%s\n' $extralib_dirs "$extralibs_tmp" | tac | awk '!x[$0]++' | tac | tr '\n' ' ')"
+    else
+        extralibs="$extralib_dirs $extralibs_tmp"
+    fi
+fi
+
 cat > ffbuild/config.mak <<EOF
 # Automatically generated by configure - do not modify!
 ifndef FFMPEG_CONFIG_MAK
-- 
2.12.1

